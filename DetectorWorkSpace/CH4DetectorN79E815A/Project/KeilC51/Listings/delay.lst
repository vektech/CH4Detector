C51 COMPILER V9.60.0.0   DELAY                                                             02/01/2020 20:17:01 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DELAY
OBJECT MODULE PLACED IN .\Objects\delay.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE ..\..\Code\Source\delay.c LARGE OPTIMIZE(8,SPEED) BROWS
                    -E INCDIR(..\..\Code\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\delay.lst) TABS(2) OBJECT(.\Objects\delay.obj)

line level    source

   1          /**
   2           *******************************************************************************
   3           * @copyright 2017-2020, Electronic Technology Co. Ltd
   4           * @file      delay.c
   5           * @version   V1.0.0
   6           * @brief     
   7           * @warning   
   8           *******************************************************************************
   9           * @remarks
  10           * 1. Version                Date                 Author
  11           *    v1.0.0                 2020年1月1日          Unknown
  12           *    Modification: 创建文档
  13           *******************************************************************************
  14           */
  15          /* NEED FIX */
  16          /*******************************************************************************
  17           *                 Include File Section ('#include')
  18           ******************************************************************************/
  19          #include "N79E81x.h"
  20          #include "GlobalAppDefine.h"
  21          
  22          #include "delay.h"
  23          #include "device.h"
  24          #include "uart.h"
  25          
  26          /*******************************************************************************
  27           *                 Macro Define Section ('#define')
  28           ******************************************************************************/
  29          #ifdef FOSC_110592
              /* 27*4/11.0592 = 10 uS */
              #define VALUE_10us 65536 - 27
              /* 2769*4/11.0592 = 1 mS */
              #define VALUE_1ms 65536 - 2769
              #endif
  35          
  36          #ifdef FOSC_184320
              /* 45*4/18.432 = 10 uS */
              #define VALUE_10us 65536 - 45
              /* 4608*4/18.432 = 1 mS */
              #define VALUE_1ms 65536 - 4608
              #endif
  42          
  43          #ifdef FOSC_221184
  44          /* 54*4/22.1184 = 10 uS */
  45          #define VALUE_10us 65536 - 54
  46          /* 5529*4/22.1184 = 1 mS */
  47          #define VALUE_1ms 65536 - 5529
  48          #endif
  49          
  50          #ifdef FOSC_368640
              /* 93*4/36.864 = 10 uS */
              #define VALUE_10us 65536 - 93
              /* 9216*4/36.864 = 1 mS */
              #define VALUE_1ms 65536 - 9216
C51 COMPILER V9.60.0.0   DELAY                                                             02/01/2020 20:17:01 PAGE 2   

              #endif
  56          
  57          /*******************************************************************************
  58           *                 Struct Define Section ('typedef')
  59           ******************************************************************************/
  60          
  61          /*******************************************************************************
  62           *                 Normal Prototype Declare Section ('function')
  63           ******************************************************************************/
  64          
  65          /*******************************************************************************
  66           *                 File Static Prototype Declare Section ('static function')
  67           ******************************************************************************/
  68          
  69          /*******************************************************************************
  70           *                 Global Variable Declare Section ('variable')
  71           ******************************************************************************/
  72          
  73          /*******************************************************************************
  74           *                 File Static Variable Define Section ('static variable')
  75           ******************************************************************************/
  76          
  77          /*******************************************************************************
  78           *                 Normal Function Define Section ('function')
  79           ******************************************************************************/
  80          void Delay10us(uint16_t count)
  81          {
  82   1          /* 打开定时器0 */
  83   1          TR0 = 1;
  84   1          while (count != 0)
  85   1          {
  86   2              /* 定时器0 低字节 */
  87   2              TL0 = LOBYTE(VALUE_10us);
  88   2              /* 定时器0 高字节 */
  89   2              TH0 = HIBYTE(VALUE_10us);
  90   2              /* TF0->TCON[5] 定时器0溢出标志
  91   2                  - 在定时器0溢出时该位置1
  92   2                  - 当程序响应定时器0中断执行相应的中断服务程序时 该位自动清0
  93   2                  - 软件也可对其写1或写0
  94   2                  */
  95   2              /* 等待定时器溢出 阻塞式延时*/
  96   2              while (TF0 != 1)
  97   2              {   
  98   3                  /* rx index */
  99   3                  if (rx_index)
 100   3                  {   
 101   4                      /* rx index = 1 打开定时器2 */
 102   4                      TR2 = 1;
 103   4                  }
 104   3              }
 105   2              /* 溢出标志清零 */
 106   2              TF0 = 0;
 107   2              count--;
 108   2          }
 109   1          /* 关闭定时器0 */
 110   1          TR0 = 0;
 111   1      }
 112          
 113          /* Delay with BOD */
 114          void Delay1ms(uint16_t count)
 115          {
 116   1          /* Brown-Out Detector 电源电压检测 */
C51 COMPILER V9.60.0.0   DELAY                                                             02/01/2020 20:17:01 PAGE 3   

 117   1          check_BOD();
 118   1          /* 打开定时器0 */
 119   1          TR0 = 1;
 120   1          while (count != 0)
 121   1          {
 122   2              /* 定时器0 低字节 */
 123   2              TL0 = LOBYTE(VALUE_1ms);
 124   2              /* 定时器0 高字节 */
 125   2              TH0 = HIBYTE(VALUE_1ms);
 126   2              /* TF0->TCON[5] 定时器0溢出标志
 127   2                  - 在定时器0溢出时该位置1
 128   2                  - 当程序响应定时器0中断执行相应的中断服务程序时 该位自动清0
 129   2                  - 软件也可对其写1或写0
 130   2                  */
 131   2              /* 等待定时器溢出 阻塞式延时*/
 132   2              while (TF0 != 1)
 133   2              {
 134   3                  ;
 135   3              }
 136   2              /* 溢出标志清零 */
 137   2              TF0 = 0;
 138   2              count--;
 139   2          }
 140   1          /* 关闭定时器0 */
 141   1          TR0 = 0;
 142   1      }
 143          
 144          /* Delay without BOD */
 145          void Delay1ms_No_BOD(uint16_t count)
 146          {
 147   1          /* 打开定时器0 */
 148   1          TR0 = 1;
 149   1          while (count != 0)
 150   1          {
 151   2              /* 定时器0 低字节 */
 152   2              TL0 = LOBYTE(VALUE_1ms);
 153   2              /* 定时器0 高字节 */
 154   2              TH0 = HIBYTE(VALUE_1ms);
 155   2              /* TF0->TCON[5] 定时器0溢出标志
 156   2                  - 在定时器0溢出时该位置1
 157   2                  - 当程序响应定时器0中断执行相应的中断服务程序时 该位自动清0
 158   2                  - 软件也可对其写1或写0
 159   2                  */
 160   2              /* 等待定时器溢出 阻塞式延时*/
 161   2              while (TF0 != 1)
 162   2              {
 163   3                  ;
 164   3              }
 165   2              /* 溢出标志清零 */
 166   2              TF0 = 0;
 167   2              count--;
 168   2          }
 169   1          /* 关闭定时器0 */
 170   1          TR0 = 0;
 171   1      }
 172          
 173          /*******************************************************************************
 174           *                 File Static Function Define Section ('static function')
 175           ******************************************************************************/
 176          
 177          /*******************************************************************************
 178           *                 End of File ('EOF')
C51 COMPILER V9.60.0.0   DELAY                                                             02/01/2020 20:17:01 PAGE 4   

 179           ******************************************************************************/
 180          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    117    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
