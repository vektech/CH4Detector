C51 COMPILER V9.60.0.0   TIMER                                                             02/01/2020 23:18:49 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE ..\..\Code\Source\timer.c LARGE OPTIMIZE(8,SPEED) BROWS
                    -E INCDIR(..\..\Code\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\timer.lst) TABS(2) OBJECT(.\Objects\timer.obj)

line level    source

   1          /**
   2           *******************************************************************************
   3           * @copyright 2017-2020, Electronic Technology Co. Ltd
   4           * @file      timer.c
   5           * @version   V1.0.0
   6           * @brief     
   7           * @warning   
   8           *******************************************************************************
   9           * @remarks
  10           * 1. Version                Date                 Author
  11           *    v1.0.0                 2020Äê1ÔÂ1ÈÕ          Unknown
  12           *    Modification: ´´½¨ÎÄµµ
  13           *******************************************************************************
  14           */
  15          
  16          /* NEED FIX */
  17          /*******************************************************************************
  18           *                 Include File Section ('#include')
  19           ******************************************************************************/
  20          #include "N79E81x.h"
  21          #include "GlobalAppDefine.h"
  22          
  23          #include "timer.h"
  24          #include "uart.h"
  25          #include "sensor.h"
  26          
  27          /*******************************************************************************
  28           *                 Macro Define Section ('#define')
  29           ******************************************************************************/
  30          
  31          /*******************************************************************************
  32           *                 Struct Define Section ('typedef')
  33           ******************************************************************************/
  34          
  35          /*******************************************************************************
  36           *                 File Static Prototype Declare Section ('static function')
  37           ******************************************************************************/
  38          
  39          /*******************************************************************************
  40           *                 Global Variable Declare Section ('variable')
  41           ******************************************************************************/
  42          bit timer2_second_flag;
  43          bit timer2_life_hour_flag;
  44          
  45          uint16_t timer2_count;
  46          uint8_t timer2_second_count;
  47          uint8_t timer2_key_long_press_count;
  48          
  49          uint16_t timer2_life_second_count;
  50          
  51          bit key_long_press_flag;
  52          
  53          /*******************************************************************************
  54           *                 File Static Variable Define Section ('static variable')
C51 COMPILER V9.60.0.0   TIMER                                                             02/01/2020 23:18:49 PAGE 2   

  55           ******************************************************************************/
  56          
  57          /*******************************************************************************
  58           *                 Normal Function Define Section ('function')
  59           ******************************************************************************/
  60          /* XXX XXX */
  61          // void timer0_init(void)
  62          // {
  63          //     /* ¶¨Ê±Æ÷0ºÍ1Ä£Ê½ÅäÖÃ 
  64          //         - [7]   = 0B  ¶¨Ê±Æ÷1 ÃÅ¿ØÖÆ µ±TR1=1Ê± ¶¨Ê±Æ÷1 Ê±ÖÓÔËÐÐ²»¹Ü~INT1µÄÂß¼­µçÆ½
  65          //         - [6]   = 0B  ¶¨Ê±Æ÷1 ¼ÆÊýÆ÷/¶¨Ê±Æ÷Ñ¡Ôñ ¶¨Ê±Æ÷1ËæÄÚ²¿Ê±ÖÓ¶øµÝÔö
  66          //         - [5:4] = 00B Ä£Ê½0: 8Î»¶¨Ê±Æ÷/¼ÆÊýÆ÷´ø5Î»Ô¤·ÖÆµ TL1[4:0]
  67          //         - [3]   = 0B  ¶¨Ê±Æ÷0 ÃÅ¿ØÖÆ µ±TR0=1Ê± ¶¨Ê±Æ÷0 Ê±ÖÓÔËÐÐ²»¹Ü~INT0µÄÂß¼­µçÆ½
  68          //         - [2]   = 0B  ¶¨Ê±Æ÷0 ¼ÆÊýÆ÷/¶¨Ê±Æ÷Ñ¡Ôñ ¶¨Ê±Æ÷0ËæÄÚ²¿Ê±ÖÓ¶øµÝÔö
  69          //         - [1:0] = 00B Ä£Ê½0: 8Î»¶¨Ê±Æ÷/¼ÆÊýÆ÷´ø5Î»Ô¤·ÖÆµ TL1[4:0]
  70          //     */
  71          //     /* XXX ¶¨Ê±Æ÷0¹¤×÷ÔÚ16Î»¶¨Ê±Ä£Ê½ */
  72          //     TMOD = 0x00;
  73          //     /* Ê±ÖÓ¿ØÖÆ
  74          //         - [4] = 0B ¶¨Ê±Æ÷1 µÄÊ±ÖÓÑ¡ÔñÎª 1/12 ÏµÍ³Ê±ÖÓ
  75          //         - [3] = 0B ¶¨Ê±Æ÷0 µÄÊ±ÖÓÑ¡ÔñÎª 1/12 ÏµÍ³Ê±ÖÓ
  76          //         */
  77          //     CKCON = 0x00;
  78          //     /* ¶¨Ê±Æ÷¼ÆÊýÖµ 0x9C40 = 40000 */
  79          //     /* ¶¨Ê±Æ÷0 ¸ß×Ö½Ú */
  80          //     TH0 = 0x9C;
  81          //     /* ¶¨Ê±Æ÷0 µÍ×Ö½Ú */
  82          //     TL0 = 0x40;
  83          
  84          //     /* ´ò¿ª¶¨Ê±Æ÷0 */
  85          //     TR0 = 1;
  86          // }
  87          
  88          void timer2_init(void)
  89          {
  90   1          /* ¶¨Ê±Æ÷2Ä£Ê½ 
  91   1              - [7]   = 1B   ÔÚ¶¨Ê±Æ÷2Òç³ö»ò·¢ÉúÊäÈë²¶»ñÊÂ¼þÊ±, Ê¹ÄÜ½« RCOMP2H ºÍ RCOMP2L ¼ÓÔØµ½ TH2 ºÍ TL2, ±È½
             -ÏÄ£Ê½ÏÂ¸ÃÎ»ÎÞÐ§
  92   1              - [6:4] = 000B timer2 clock divider is 1/4
  93   1              - [3]   = 0B   ·¢Éú²¶»ñÊÂ¼þºó, ¶¨Ê±Æ÷2¼ÌÐø¼ÆÊý 
  94   1              - [2]   = 0B   ·¢Éú±È½ÏÆ¥ÅäÊ±, ¶¨Ê±Æ÷2¼ÌÐø¼ÆÊý
  95   1              - [1:0] = 00B  ¶¨Ê±Æ÷2Òç³öÖØ¼ÓÔØ
  96   1              */
  97   1          T2MOD = 0x80;
  98   1          /* ¶¨Ê±Æ÷¼ÆÊýÖµ 0x2806 = 10246 */
  99   1          /* ¶¨Ê±Æ÷2 ¸ß×Ö½Ú */
 100   1          TH2 = 0x28;
 101   1          /* ¶¨Ê±Æ÷2 µÍ×Ö½Ú */
 102   1          TL2 = 0x06;
 103   1      
 104   1          /* ¶¨Ê±Æ÷2 ÉèÖÃÎª±È½ÏÄ£Ê½ µ±¶¨Ê±Æ÷2ÏòÉÏ¼ÆÊý, TH2ºÍTL2ÓëRCOMP2HºÍRCOMP2LÖµÆ¥Åä, TF3(T2CON.7) ½«ÓÉÓ²¼þÖÃ
             -Î»ÒÔÊ¾ÓÐ±È½ÏÆ¥ÅäÊ±¼ä·¢Éú */
 105   1          CP_RL2 = 1;
 106   1          /* ¶¨Ê±Æ÷2 ÖØ¼ÓÔØ/±È½ÏµÍ×Ö½Ú */
 107   1          RCOMP2L = TL2;
 108   1          /* ¶¨Ê±Æ÷2 ÖØ¼ÓÔØ/±È½Ï¸ß×Ö½Ú */
 109   1          RCOMP2H = TH2;
 110   1      
 111   1          /* ´ò¿ª¶¨Ê±Æ÷2 */
 112   1          TR2 = 1;
 113   1      }
 114          
C51 COMPILER V9.60.0.0   TIMER                                                             02/01/2020 23:18:49 PAGE 3   

 115          /* ¶¨Ê±Æ÷T2 ×öÎªÔ¤ÈÈµÆÉÁË¸¿ØÖÆ¶¨Ê±Æ÷ºÍ¼ä¸ô5Ãë·¢Ò»´ÎÊý¾Ý¶¨Ê±Æ÷ ¶¨Ê±Æ÷T1 ×öÎª´®¿Ú²¨ÌØÂÊ¼ÓÔØÓÃ¶¨Ê±Æ÷ */
 116          /* TIMER2 ÖÐ¶Ï·þÎñº¯Êý Vecotr @ 0x2B ÖÐ¶ÏÒ»´Î12ms */
 117          void Timer2_ISR(void) interrupt 5
 118          {
 119   1          /* ¶¨Ê±Æ÷2Òç³ö±êÖ¾ ±ØÐëÈí¼þÇåÁã */
 120   1          TF2 = 0;
 121   1      
 122   1          /* ½ÓÊÕ³¬Ê± */
 123   1          if (++rx_count > RXTIMEOUT)
 124   1          {
 125   2              rx_count = 0;
 126   2              /* »ñÈ¡ÁË4¸öÒÔÉÏ×Ö½ÚµÄÊý¾Ý */
 127   2              if ((rx_index >= RX_MIN_LENGTH))
 128   2              {
 129   3                  if (rx_finished == false)
 130   3                  {
 131   4                      /* ¹Ø±Õ´®¿Ú0µÄ½ÓÊÕ¹¦ÄÜ */
 132   4                      UART0_RX_DISABLE;
 133   4                      /* ½ÓÊÕ±êÖ¾ÖÃÎª1 */
 134   4                      rx_finished = true;
 135   4                  }
 136   3              }
 137   2              else
 138   2              {
 139   3                  rx_finished = false;
 140   3                  rx_index = 0;
 141   3              }
 142   2          }
 143   1      
 144   1          /* Ê±¼ä¼ÆÊý¼Ó1 */
 145   1          timer2_count++;
 146   1          /* Ãë¼ÆÊý¼Ó1 */
 147   1          timer2_second_count++;
 148   1      
 149   1          /* Ô¤ÈÈ×´Ì¬ÏÂµÆÉÁË¸ÆµÂÊ */
 150   1          if (timer2_count == 20)
 151   1          {
 152   2              if (sensor_preheat == 0)
 153   2              {
 154   3                  /* µçÔ´µÆ·­×ª */
 155   3                  LED_POWER_TOGGLE;
 156   3              }
 157   2              timer2_count = 0;
 158   2              sensor_preheat_time_count++;
 159   2          }
 160   1      
 161   1          /* Ô¤ÈÈÍê³É ±êÖ¾Î»ÖÃ Delay_Time_Count = 750 Îª3·ÖÖÓ*/
 162   1          if (sensor_preheat_time_count == Delay_Time_Count)
 163   1          {
 164   2              sensor_preheat = 1;
 165   2          }
 166   1      
 167   1          /* ¼ÆÊ±100´ÎÍê³É */
 168   1          if (timer2_second_count == 100)
 169   1          {
 170   2              timer2_second_count = 0;
 171   2              timer2_second_flag = 1;
 172   2      
 173   2              /* ÊÙÃüµ½ÆÚ¼ÆÊ±Êý */
 174   2              timer2_life_second_count++;
 175   2      
 176   2      
C51 COMPILER V9.60.0.0   TIMER                                                             02/01/2020 23:18:49 PAGE 4   

 177   2              if (key_long_press_flag)
 178   2              {
 179   3                  timer2_key_long_press_count++;
 180   3              }
 181   2          }
 182   1      
 183   1          /* 1Ð¡Ê±±êÖ¾Î» */
 184   1          if (timer2_life_second_count == 3600)
 185   1          {
 186   2              timer2_life_hour_flag = 1;
 187   2              timer2_life_second_count = 0;
 188   2          }
 189   1      }
 190          
 191          /*******************************************************************************
 192           *                 File Static Function Define Section ('static function')
 193           ******************************************************************************/
 194          
 195          /*******************************************************************************
 196           *                 End of File ('EOF')
 197           ******************************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    219    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
